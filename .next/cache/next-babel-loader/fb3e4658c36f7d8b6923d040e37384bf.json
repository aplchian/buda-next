{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/aplchian/Documents/code/buda-next/react-auth0-spa.tsx\",\n    _s = $RefreshSig$(),\n    _this = this,\n    _s2 = $RefreshSig$();\n\nimport React, { useContext, useEffect, useState } from 'react';\nimport axios from 'axios';\nimport auth0 from 'auth0-js';\nimport history from './utils/history';\n\nvar DEFAULT_REDIRECT_CALLBACK = function DEFAULT_REDIRECT_CALLBACK() {\n  return window.history.replaceState({}, document.title, window.location.pathname);\n};\n\n_c = DEFAULT_REDIRECT_CALLBACK;\nvar auth;\nexport var Auth0Context = /*#__PURE__*/React.createContext({});\nexport var useAuth0 = function useAuth0() {\n  _s();\n\n  return useContext(Auth0Context);\n};\n\n_s(useAuth0, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport var Auth0Provider = function Auth0Provider(_ref) {\n  _s2();\n\n  var children = _ref.children,\n      _ref$onRedirectCallba = _ref.onRedirectCallback,\n      onRedirectCallback = _ref$onRedirectCallba === void 0 ? DEFAULT_REDIRECT_CALLBACK : _ref$onRedirectCallba,\n      initOptions = _objectWithoutProperties(_ref, [\"children\", \"onRedirectCallback\"]);\n\n  var _useState = useState(),\n      isAuthenticated = _useState[0],\n      setIsAuthenticated = _useState[1];\n\n  var _useState2 = useState(),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(),\n      auth0Client = _useState3[0];\n\n  var _useState4 = useState(true),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState(false),\n      popupOpen = _useState5[0];\n\n  useEffect(function () {\n    var initAuth0 = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                auth = new auth0.WebAuth(initOptions);\n                handleAuthentication();\n                getUser();\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function initAuth0() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    initAuth0(); // eslint-disable-next-line\n  }, []);\n\n  var getUser = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var token;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (checkAuthenticated()) {\n                token = localStorage.getItem('access_token');\n\n                if (token) {\n                  // @ts-ignore\n                  auth.client.userInfo(token, /*#__PURE__*/function () {\n                    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(err, profile) {\n                      var app_token, bdu, _isAuthenticated;\n\n                      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                        while (1) {\n                          switch (_context2.prev = _context2.next) {\n                            case 0:\n                              if (!profile) {\n                                _context2.next = 12;\n                                break;\n                              }\n\n                              app_token = localStorage.getItem('id_token');\n                              _context2.next = 4;\n                              return axios.get('//editserv.bdrc.io/resource-nc/user/me', {\n                                headers: {\n                                  Authorization: 'Bearer ' + app_token\n                                }\n                              });\n\n                            case 4:\n                              bdu = _context2.sent;\n                              profile.bdrcData = bdu.data;\n                              profile.bdrcID = Object.keys(bdu.data).map(function (k) {\n                                return k.replace(/^.*?[/]([^/]+)$/, 'bdu:$1');\n                              }).join();\n                              setUser(profile);\n                              _isAuthenticated = checkAuthenticated();\n                              setIsAuthenticated(_isAuthenticated);\n                              setLoading(false);\n                              console.log('profile', profile);\n\n                            case 12:\n                            case \"end\":\n                              return _context2.stop();\n                          }\n                        }\n                      }, _callee2);\n                    }));\n\n                    return function (_x, _x2) {\n                      return _ref4.apply(this, arguments);\n                    };\n                  }());\n                }\n              } else {\n                setLoading(false);\n              }\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function getUser() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var login = function login(redirect) {\n    console.log('redirect', redirect);\n    if (redirect) localStorage.setItem('auth0_redirect', JSON.stringify(redirect));else localStorage.setItem('auth0_redirect', '/');\n    auth.authorize();\n  };\n\n  var checkAuthenticated = function checkAuthenticated() {\n    // Check whether the current time is past the\n    // Access Token's expiry time\n    var item = localStorage.getItem('expires_at');\n    if (!item) return false;\n    var expiresAt = JSON.parse(item);\n    return new Date().getTime() < expiresAt;\n  };\n\n  var setSession = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(authResult) {\n      var expiresAt;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              // Set the time that the Access Token will expire at\n              expiresAt = JSON.stringify(authResult.expiresIn * 1000 + new Date().getTime());\n              localStorage.setItem('access_token', authResult.accessToken);\n              localStorage.setItem('id_token', authResult.idToken);\n              localStorage.setItem('expires_at', expiresAt);\n              console.log('session', authResult);\n              getUser();\n\n            case 6:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function setSession(_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var handleAuthentication = function handleAuthentication() {\n    auth.parseHash( /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(err, authResult) {\n        var redirect;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (authResult && authResult.accessToken && authResult.idToken) {\n                  setSession(authResult);\n                  redirect = JSON.parse(localStorage.getItem('auth0_redirect'));\n\n                  if (redirect) {\n                    history.push(redirect); // TODO find something better to force rerendering\n\n                    window.location.reload();\n                  } else window.history.replaceState(null, null, ' ');\n                } else if (err) {\n                  console.log(err);\n                }\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function (_x4, _x5) {\n        return _ref6.apply(this, arguments);\n      };\n    }());\n  };\n  /*\n  const initAuth0 = async () => {\n    \n    const auth0FromHook = await createAuth0Client(initOptions);\n     setAuth0(auth0FromHook);      \n     if (window.location.search.includes(\"code=\") &&\n        window.location.search.includes(\"state=\")) {\n        try {\n          const { appState } = await auth0FromHook.handleRedirectCallback();\n          onRedirectCallback(appState);\n        }\n        catch(e) {\n          console.error(\"auth0 error\",e)\n        }\n    }\n     const isAuthenticated = await auth0FromHook.isAuthenticated();\n     setIsAuthenticated(isAuthenticated);\n     if (isAuthenticated) {\n      const user = await auth0FromHook.getUser();\n      setUser(user);\n    }\n     setLoading(false);\n  };\n  const loginWithPopup = async (params = {}) => {\n  setPopupOpen(true);\n  try {\n    await auth0Client.loginWithPopup(params);\n  } catch (error) {\n    console.error(error);\n  } finally {\n    setPopupOpen(false);\n  }\n  const user = await auth0Client.getUser();\n  setUser(user);\n  setIsAuthenticated(true);\n  };\n  const handleRedirectCallback = async () => {\n  setLoading(true);\n  await auth0Client.handleRedirectCallback();\n  const user = await auth0Client.getUser();\n  setLoading(false);\n  setIsAuthenticated(true);\n  setUser(user);\n  };\n  */\n\n\n  return /*#__PURE__*/_jsxDEV(Auth0Context.Provider, {\n    value: {\n      isAuthenticated: isAuthenticated,\n      user: user,\n      loading: loading,\n      popupOpen: popupOpen,\n      // handleRedirectCallback,\n      // @ts-ignore\n      getIdTokenClaims: function getIdTokenClaims() {\n        return auth0Client.getIdTokenClaims.apply(auth0Client, arguments);\n      },\n      // @ts-ignore\n      loginWithRedirect: function loginWithRedirect() {\n        return login.apply(void 0, arguments);\n      },\n      // @ts-ignore\n      getTokenSilently: function getTokenSilently() {\n        return auth0Client.getTokenSilently.apply(auth0Client, arguments);\n      },\n      getTokenWithPopup: function getTokenWithPopup() {\n        return (// @ts-ignore\n          auth0Client.getTokenWithPopup.apply(auth0Client, arguments)\n        );\n      },\n      logout: function logout() {\n        localStorage.removeItem('access_token');\n        localStorage.removeItem('id_token');\n        localStorage.removeItem('expires_at');\n        setIsAuthenticated(false);\n      }\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 194,\n    columnNumber: 9\n  }, _this);\n};\n\n_s2(Auth0Provider, \"UmVzWpK4m690vJdyIyvQvEeCpBA=\");\n\n_c2 = Auth0Provider;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"DEFAULT_REDIRECT_CALLBACK\");\n$RefreshReg$(_c2, \"Auth0Provider\");","map":{"version":3,"sources":["/Users/aplchian/Documents/code/buda-next/react-auth0-spa.tsx"],"names":["React","useContext","useEffect","useState","axios","auth0","history","DEFAULT_REDIRECT_CALLBACK","window","replaceState","document","title","location","pathname","auth","Auth0Context","createContext","useAuth0","Auth0Provider","children","onRedirectCallback","initOptions","isAuthenticated","setIsAuthenticated","user","setUser","auth0Client","loading","setLoading","popupOpen","initAuth0","WebAuth","handleAuthentication","getUser","checkAuthenticated","token","localStorage","getItem","client","userInfo","err","profile","app_token","get","headers","Authorization","bdu","bdrcData","data","bdrcID","Object","keys","map","k","replace","join","console","log","login","redirect","setItem","JSON","stringify","authorize","item","expiresAt","parse","Date","getTime","setSession","authResult","expiresIn","accessToken","idToken","parseHash","push","reload","getIdTokenClaims","loginWithRedirect","getTokenSilently","getTokenWithPopup","logout","removeItem"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport axios from 'axios'\nimport auth0, { AuthOptions } from 'auth0-js'\nimport history from './utils/history'\n\nconst DEFAULT_REDIRECT_CALLBACK = () =>\n    window.history.replaceState({}, document.title, window.location.pathname)\n\nvar auth: auth0.WebAuth\n\nexport const Auth0Context = React.createContext({})\n\ninterface AuthUser {\n    user?: any\n    loading?: boolean\n    isAuthenticated: boolean\n    loginWithRedirect: any\n    logout: any\n}\nexport const useAuth0 = (): AuthUser => useContext(Auth0Context) as AuthUser\n\nexport const Auth0Provider = ({\n    children,\n    onRedirectCallback = DEFAULT_REDIRECT_CALLBACK,\n    ...initOptions\n}: {\n    children: React.ReactElement\n    onRedirectCallback: (appState: { targetUrl: any }) => void\n}) => {\n    const [isAuthenticated, setIsAuthenticated] = useState<boolean>()\n    const [user, setUser] = useState()\n    const [auth0Client] = useState()\n    const [loading, setLoading] = useState(true)\n    const [popupOpen] = useState(false)\n\n    useEffect(() => {\n        const initAuth0 = async () => {\n            auth = new auth0.WebAuth(initOptions as AuthOptions)\n            handleAuthentication()\n            getUser()\n        }\n\n        initAuth0()\n        // eslint-disable-next-line\n    }, [])\n\n    const getUser = async () => {\n        if (checkAuthenticated()) {\n            const token = localStorage.getItem('access_token')\n            if (token) {\n                // @ts-ignore\n                auth.client.userInfo(token, async (\n                    err: any,\n                    // @ts-ignore\n                    profile: {\n                        (prevState: undefined): undefined\n                        bdrcData?: any\n                        bdrcID?: any\n                    }\n                ) => {\n                    if (profile) {\n                        const app_token = localStorage.getItem('id_token')\n                        const bdu = await axios.get(\n                            '//editserv.bdrc.io/resource-nc/user/me',\n                            {\n                                headers: {\n                                    Authorization: 'Bearer ' + app_token,\n                                },\n                            }\n                        )\n                        profile.bdrcData = bdu.data\n                        profile.bdrcID = Object.keys(bdu.data)\n                            .map(k => k.replace(/^.*?[/]([^/]+)$/, 'bdu:$1'))\n                            .join()\n                        setUser(profile)\n\n                        const isAuthenticated = checkAuthenticated()\n                        setIsAuthenticated(isAuthenticated)\n\n                        setLoading(false)\n\n                        console.log('profile', profile)\n                    }\n                })\n            }\n        } else {\n            setLoading(false)\n        }\n    }\n\n    const login = (redirect: any) => {\n        console.log('redirect', redirect)\n        if (redirect)\n            localStorage.setItem('auth0_redirect', JSON.stringify(redirect))\n        else localStorage.setItem('auth0_redirect', '/')\n        auth.authorize()\n    }\n\n    const checkAuthenticated = () => {\n        // Check whether the current time is past the\n        // Access Token's expiry time\n        let item = localStorage.getItem('expires_at')\n        if (!item) return false\n        let expiresAt = JSON.parse(item)\n        return new Date().getTime() < expiresAt\n    }\n\n    const setSession = async (authResult: auth0.Auth0DecodedHash) => {\n        // Set the time that the Access Token will expire at\n        let expiresAt = JSON.stringify(\n            authResult.expiresIn * 1000 + new Date().getTime()\n        )\n        localStorage.setItem('access_token', authResult.accessToken)\n        localStorage.setItem('id_token', authResult.idToken)\n        localStorage.setItem('expires_at', expiresAt)\n\n        console.log('session', authResult)\n\n        getUser()\n    }\n\n    const handleAuthentication = () => {\n        auth.parseHash(async (err, authResult) => {\n            if (authResult && authResult.accessToken && authResult.idToken) {\n                setSession(authResult)\n                let redirect = JSON.parse(\n                    localStorage.getItem('auth0_redirect')\n                )\n                if (redirect) {\n                    history.push(redirect)\n                    // TODO find something better to force rerendering\n                    window.location.reload()\n                } else window.history.replaceState(null, null, ' ')\n            } else if (err) {\n                console.log(err)\n            }\n        })\n    }\n\n    /*\n    const initAuth0 = async () => {\n      \n      const auth0FromHook = await createAuth0Client(initOptions);\n\n      setAuth0(auth0FromHook);      \n\n      if (window.location.search.includes(\"code=\") &&\n          window.location.search.includes(\"state=\")) {\n          try {\n            const { appState } = await auth0FromHook.handleRedirectCallback();\n            onRedirectCallback(appState);\n          }\n          catch(e) {\n            console.error(\"auth0 error\",e)\n          }\n      }\n\n      const isAuthenticated = await auth0FromHook.isAuthenticated();\n\n      setIsAuthenticated(isAuthenticated);\n\n      if (isAuthenticated) {\n        const user = await auth0FromHook.getUser();\n        setUser(user);\n      }\n\n      setLoading(false);\n    };\n  const loginWithPopup = async (params = {}) => {\n    setPopupOpen(true);\n    try {\n      await auth0Client.loginWithPopup(params);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setPopupOpen(false);\n    }\n    const user = await auth0Client.getUser();\n    setUser(user);\n    setIsAuthenticated(true);\n  };\n\n  const handleRedirectCallback = async () => {\n    setLoading(true);\n    await auth0Client.handleRedirectCallback();\n    const user = await auth0Client.getUser();\n    setLoading(false);\n    setIsAuthenticated(true);\n    setUser(user);\n  };\n    */\n\n    return (\n        <Auth0Context.Provider\n            value={{\n                isAuthenticated,\n                user,\n                loading,\n                popupOpen,\n                // handleRedirectCallback,\n                // @ts-ignore\n                getIdTokenClaims: (...p) => auth0Client.getIdTokenClaims(...p),\n                // @ts-ignore\n                loginWithRedirect: (...p) => login(...p),\n                // @ts-ignore\n                getTokenSilently: (...p) => auth0Client.getTokenSilently(...p),\n                getTokenWithPopup: (...p: any) =>\n                    // @ts-ignore\n                    auth0Client.getTokenWithPopup(...p),\n                logout: (...p: any) => {\n                    localStorage.removeItem('access_token')\n                    localStorage.removeItem('id_token')\n                    localStorage.removeItem('expires_at')\n                    setIsAuthenticated(false)\n                },\n            }}\n        >\n            {children}\n        </Auth0Context.Provider>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}