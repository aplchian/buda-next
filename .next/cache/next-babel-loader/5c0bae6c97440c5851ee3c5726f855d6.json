{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/aplchian/Documents/code/buda-next/App.tsx\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport '../buda/src/index.css';\nimport AppBar from './components/AppBar';\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles';\nimport Card from './components/Card';\nimport { DndProvider } from 'react-dnd';\nimport FilterList from './components/FilterList';\nimport Backend from 'react-dnd-html5-backend';\nimport postUpdate from './api/postUpdate';\nimport { useTranslation } from 'react-i18next';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { useAuth0 } from '../buda/src/react-auth0-spa';\nimport { addIndex, assoc, curry, dissoc, inc, insert, lensPath, map, over, propEq, reduce, reject, set, view } from 'ramda';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport Dialog from './components/Dialog';\nimport InfiniteScroll from 'react-infinite-scroller';\nimport CardDropZone from './components/CardDropZone';\nimport { getOrInitManifest } from './api/getManifest';\nimport VolumeSearch from './components/VolumeSearch';\nimport UpdateManifestError from './components/UpdateManifestError';\nimport { setManifest } from './redux/actions/manifest';\nimport { connect } from 'react-redux';\nvar mapIndex = addIndex(map);\nvar theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: '#212121'\n    }\n  }\n});\nvar imageListLens = lensPath(['view', 'view1', 'imagelist']);\n\nfunction App(props) {\n  _s();\n\n  var _this = this;\n\n  var manifest = props.manifest;\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      settingsDialogOpen = _React$useState2[0],\n      setSettingsDialog = _React$useState2[1];\n\n  var imageList = view(imageListLens, manifest) || [];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      isFetching = _React$useState4[0],\n      setIsFetching = _React$useState4[1];\n\n  var _React$useState5 = React.useState(null),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      fetchErr = _React$useState6[0],\n      setFetchErr = _React$useState6[1];\n\n  var _React$useState7 = React.useState(9),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      renderToIdx = _React$useState8[0],\n      setRenderToIdx = _React$useState8[1];\n\n  var _React$useState9 = React.useState(false),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      isLoadingMore = _React$useState10[0],\n      setIsLoadingMore = _React$useState10[1];\n\n  var _React$useState11 = React.useState(null),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      postErr = _React$useState12[0],\n      setPostErr = _React$useState12[1];\n\n  var dispatch = props.dispatch;\n  React.useEffect(function () {\n    var search = window.location.search;\n    var params = new URLSearchParams(search);\n    var volume = params.get('volume');\n    setFetchErr(null);\n\n    if (!volume) {\n      setIsFetching(false);\n    } else {\n      var getData = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var _yield$getOrInitManif, _manifest;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  setIsFetching(true);\n                  _context.prev = 1;\n                  _context.next = 4;\n                  return getOrInitManifest(volume, {\n                    uiLanguage: 'en'\n                  });\n\n                case 4:\n                  _yield$getOrInitManif = _context.sent;\n                  _manifest = _yield$getOrInitManif.manifest;\n                  setIsFetching(false);\n                  dispatch(setManifest(_manifest));\n                  _context.next = 14;\n                  break;\n\n                case 10:\n                  _context.prev = 10;\n                  _context.t0 = _context[\"catch\"](1);\n                  setIsFetching(false);\n                  setFetchErr(_context.t0.message);\n\n                case 14:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[1, 10]]);\n        }));\n\n        return function getData() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      getData();\n    }\n  }, [dispatch]);\n\n  var saveUpdatesToManifest = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(auth) {\n      var removeCollapsed, formattedManifest;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              removeCollapsed = map(dissoc('collapsed'));\n              formattedManifest = over(imageListLens, removeCollapsed, manifest);\n              _context2.next = 5;\n              return postUpdate(formattedManifest, auth);\n\n            case 5:\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n\n              if (_context2.t0.response) {\n                setPostErr(_context2.t0.response.data);\n              } else if (_context2.t0.request) {\n                setPostErr(_context2.t0.request);\n              } else {\n                setPostErr(_context2.t0.message);\n              }\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function saveUpdatesToManifest(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var updateImageList = function updateImageList(updatedImageList) {\n    props.dispatch(setManifest(set(imageListLens, updatedImageList, manifest)));\n  };\n\n  var handleLoadMore = function handleLoadMore() {\n    setRenderToIdx(renderToIdx + 10); // setting this isfetching stops the infinite scroll from getting caught in a loop\n\n    setIsLoadingMore(true);\n    setTimeout(function () {\n      setIsLoadingMore(false);\n    }, 3000);\n  };\n\n  var sectionInUseCount = function sectionInUseCount(sectionId) {\n    return reduce(function (acc, val) {\n      return val.sectionId === sectionId ? ++acc : acc;\n    }, 0, imageList);\n  };\n\n  var handleSettingsUpdate = curry(function (lens, value) {\n    var updatedManifest = set(lens, value, manifest);\n    props.dispatch(setManifest(updatedManifest));\n  });\n\n  var rearrangeImage = function rearrangeImage(imageId, idx) {\n    var _reduce = reduce(function (acc, val) {\n      if (val.id === imageId) {\n        var valToRemove = assoc('remove', true, val);\n        acc.image = val;\n        acc.images.push(valToRemove);\n        return acc;\n      }\n\n      acc.images.push(val);\n      return acc;\n    }, {\n      image: null,\n      images: []\n    }, imageList),\n        image = _reduce.image,\n        images = _reduce.images;\n\n    var updatedImageList = reject(propEq('remove', true), insert(inc(idx), image, images));\n    updateImageList(updatedImageList);\n  };\n\n  var foldCheckedImages = function foldCheckedImages() {\n    var updatedImageList = map(function (image) {\n      return image.reviewed ? assoc('collapsed', true, image) : image;\n    }, imageList);\n    updateImageList(updatedImageList);\n  };\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var auth = useAuth0();\n  var imageListLength = imageList.length;\n  return /*#__PURE__*/_jsxDEV(ThemeProvider, {\n    theme: theme,\n    children: /*#__PURE__*/_jsxDEV(DndProvider, {\n      backend: Backend,\n      children: [/*#__PURE__*/_jsxDEV(AppBar, {\n        manifest: manifest,\n        handleSettingsUpdate: handleSettingsUpdate,\n        children: !manifest.isDefault && /*#__PURE__*/_jsxDEV(FilterList, {\n          handleSettingsUpdate: handleSettingsUpdate,\n          manifest: manifest,\n          foldCheckedImages: foldCheckedImages\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(UpdateManifestError, {\n        postErr: postErr,\n        setPostErr: setPostErr\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), manifest.isDefault ? /*#__PURE__*/_jsxDEV(VolumeSearch, _objectSpread({\n        isFetching: isFetching,\n        fetchErr: fetchErr\n      }, manifest && manifest['imggroup'] ? {\n        forVolume: manifest['imggroup']\n      } : {}), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App\",\n        style: {\n          paddingTop: 125\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Dialog, {\n            appData: manifest.appData,\n            sectionInUseCount: sectionInUseCount,\n            open: settingsDialogOpen,\n            handleClose: function handleClose() {\n              return setSettingsDialog(false);\n            },\n            manifest: manifest,\n            handleSettingsUpdate: handleSettingsUpdate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container mx-auto flex flex-row py-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-1/2 flex flex-col\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-600 text-sm\",\n                children: t('Volume')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 212,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-sm font-bold text-xl mb-3\",\n                children: [manifest['imggroup'], /*#__PURE__*/_jsxDEV(\"span\", {\n                  onClick: function onClick() {\n                    return setSettingsDialog(true);\n                  },\n                  className: \"underline text-md font-medium cursor-pointer\",\n                  children: /*#__PURE__*/_jsxDEV(SettingsIcon, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 223,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 217,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 215,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-1/2 flex flex-col\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"self-end\",\n                children: auth.isAuthenticated && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"underline text-md font-medium cursor-pointer mr-5\",\n                  onClick: function onClick() {\n                    return saveUpdatesToManifest(auth);\n                  },\n                  children: t('SAVE')\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 233,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 231,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"container mx-auto\",\n            children: /*#__PURE__*/_jsxDEV(InfiniteScroll, {\n              pageStart: 0,\n              loadMore: handleLoadMore,\n              hasMore: imageList.length > renderToIdx && !isLoadingMore,\n              loader: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"container mx-auto flex items-center justify-center\",\n                children: /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 259,\n                  columnNumber: 45\n                }, this)\n              }, \"circular\", false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 41\n              }, this),\n              useWindow: true,\n              children: mapIndex(function (item, i) {\n                return /*#__PURE__*/_jsxDEV(React.Fragment, {\n                  children: [i === 0 && /*#__PURE__*/_jsxDEV(CardDropZone, {\n                    i: -1,\n                    handleDrop: rearrangeImage\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 268,\n                    columnNumber: 53\n                  }, _this), /*#__PURE__*/_jsxDEV(Card, {\n                    imageListLength: imageListLength,\n                    data: item,\n                    i: i\n                  }, item.id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 275,\n                    columnNumber: 49\n                  }, _this), /*#__PURE__*/_jsxDEV(CardDropZone, {\n                    i: i,\n                    handleDrop: rearrangeImage\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 283,\n                    columnNumber: 49\n                  }, _this)]\n                }, i, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 266,\n                  columnNumber: 45\n                }, _this);\n              }, imageList.slice(0, renderToIdx))\n            }, 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 173,\n    columnNumber: 9\n  }, this);\n}\n\n_s(App, \"mtfWwQK8i5swbpksey0dpYgcdEo=\", false, function () {\n  return [useTranslation, useAuth0];\n});\n\n_c = App;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    manifest: state.manifest\n  };\n};\n\nexport default connect(mapStateToProps)(App);\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/aplchian/Documents/code/buda-next/App.tsx"],"names":["React","AppBar","createMuiTheme","ThemeProvider","Card","DndProvider","FilterList","Backend","postUpdate","useTranslation","CircularProgress","useAuth0","addIndex","assoc","curry","dissoc","inc","insert","lensPath","map","over","propEq","reduce","reject","set","view","SettingsIcon","Dialog","InfiniteScroll","CardDropZone","getOrInitManifest","VolumeSearch","UpdateManifestError","setManifest","connect","mapIndex","theme","palette","primary","main","imageListLens","App","props","manifest","useState","settingsDialogOpen","setSettingsDialog","imageList","isFetching","setIsFetching","fetchErr","setFetchErr","renderToIdx","setRenderToIdx","isLoadingMore","setIsLoadingMore","postErr","setPostErr","dispatch","useEffect","search","window","location","params","URLSearchParams","volume","get","getData","uiLanguage","message","saveUpdatesToManifest","auth","removeCollapsed","formattedManifest","response","data","request","updateImageList","updatedImageList","handleLoadMore","setTimeout","sectionInUseCount","sectionId","acc","val","handleSettingsUpdate","lens","value","updatedManifest","rearrangeImage","imageId","idx","id","valToRemove","image","images","push","foldCheckedImages","reviewed","t","imageListLength","length","isDefault","forVolume","paddingTop","appData","isAuthenticated","item","i","slice","mapStateToProps","state"],"mappings":"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","sourcesContent":["import React from 'react'\nimport '../buda/src/index.css'\nimport AppBar from './components/AppBar'\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles'\nimport Card from './components/Card'\nimport { DndProvider } from 'react-dnd'\nimport FilterList from './components/FilterList'\nimport Backend from 'react-dnd-html5-backend'\nimport postUpdate from './api/postUpdate'\nimport { useTranslation } from 'react-i18next'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport { useAuth0 } from '../buda/src/react-auth0-spa'\nimport {\n    addIndex,\n    assoc,\n    curry,\n    dissoc,\n    inc,\n    insert,\n    lensPath,\n    map,\n    over,\n    propEq,\n    reduce,\n    reject,\n    set,\n    view,\n} from 'ramda'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport Dialog from './components/Dialog'\nimport InfiniteScroll from 'react-infinite-scroller'\nimport CardDropZone from './components/CardDropZone'\nimport { getOrInitManifest } from './api/getManifest'\nimport VolumeSearch from './components/VolumeSearch'\nimport UpdateManifestError from './components/UpdateManifestError'\nimport { Buda } from '../buda/types'\nimport { setManifest } from './redux/actions/manifest'\nimport { connect } from 'react-redux'\n\nconst mapIndex = addIndex(map)\nconst theme = createMuiTheme({\n    palette: {\n        primary: {\n            main: '#212121',\n        },\n    },\n})\n\nconst imageListLens = lensPath(['view', 'view1', 'imagelist'])\n\nfunction App(props: any) {\n    const { manifest } = props\n\n    const [settingsDialogOpen, setSettingsDialog] = React.useState(false)\n    const imageList = (view(imageListLens, manifest) as Buda.Image[]) || []\n    const [isFetching, setIsFetching] = React.useState(false)\n    const [fetchErr, setFetchErr] = React.useState(null)\n    const [renderToIdx, setRenderToIdx] = React.useState(9)\n    const [isLoadingMore, setIsLoadingMore] = React.useState(false)\n    const [postErr, setPostErr] = React.useState(null)\n\n    const { dispatch } = props\n    React.useEffect(() => {\n        const search = window.location.search\n        const params = new URLSearchParams(search)\n        const volume = params.get('volume')\n        setFetchErr(null)\n        if (!volume) {\n            setIsFetching(false)\n        } else {\n            const getData = async () => {\n                setIsFetching(true)\n                try {\n                    const { manifest } = await getOrInitManifest(volume, {\n                        uiLanguage: 'en',\n                    })\n                    setIsFetching(false)\n                    dispatch(setManifest(manifest))\n                } catch (err) {\n                    setIsFetching(false)\n                    setFetchErr(err.message)\n                }\n            }\n            getData()\n        }\n    }, [dispatch])\n\n    const saveUpdatesToManifest = async (auth: any) => {\n        try {\n            const removeCollapsed = map(dissoc('collapsed'))\n            const formattedManifest = over(\n                imageListLens,\n                removeCollapsed,\n                manifest\n            )\n            await postUpdate(formattedManifest, auth)\n        } catch (error) {\n            if (error.response) {\n                setPostErr(error.response.data)\n            } else if (error.request) {\n                setPostErr(error.request)\n            } else {\n                setPostErr(error.message)\n            }\n        }\n    }\n    const updateImageList = (updatedImageList: unknown[]) => {\n        props.dispatch(\n            setManifest(set(imageListLens, updatedImageList, manifest))\n        )\n    }\n    const handleLoadMore = () => {\n        setRenderToIdx(renderToIdx + 10)\n        // setting this isfetching stops the infinite scroll from getting caught in a loop\n        setIsLoadingMore(true)\n        setTimeout(() => {\n            setIsLoadingMore(false)\n        }, 3000)\n    }\n    const sectionInUseCount = (sectionId: string) => {\n        return reduce(\n            (acc: number, val: Buda.Image) => {\n                return val.sectionId === sectionId ? ++acc : acc\n            },\n            0,\n            imageList\n        )\n    }\n    const handleSettingsUpdate = curry((lens, value) => {\n        const updatedManifest = set(lens, value, manifest)\n        props.dispatch(setManifest(updatedManifest))\n    })\n\n    const rearrangeImage = (imageId: string, idx: number) => {\n        const { image, images } = reduce(\n            (acc, val) => {\n                if (val.id === imageId) {\n                    const valToRemove = assoc('remove', true, val)\n                    acc.image = val\n                    acc.images.push(valToRemove)\n                    return acc\n                }\n                acc.images.push(val)\n                return acc\n            },\n            {\n                image: null,\n                images: [],\n            },\n            imageList\n        )\n        const updatedImageList = reject(\n            propEq('remove', true),\n            insert(inc(idx), image, images)\n        )\n        updateImageList(updatedImageList)\n    }\n\n    const foldCheckedImages = () => {\n        const updatedImageList = map(\n            image => (image.reviewed ? assoc('collapsed', true, image) : image),\n            imageList\n        )\n        updateImageList(updatedImageList)\n    }\n\n    const { t } = useTranslation()\n    const auth = useAuth0()\n\n    const imageListLength = imageList.length\n\n    return (\n        <ThemeProvider theme={theme}>\n            <DndProvider backend={Backend}>\n                <AppBar\n                    manifest={manifest}\n                    handleSettingsUpdate={handleSettingsUpdate}\n                >\n                    {!manifest.isDefault && (\n                        <FilterList\n                            handleSettingsUpdate={handleSettingsUpdate}\n                            manifest={manifest}\n                            foldCheckedImages={foldCheckedImages}\n                        />\n                    )}\n                </AppBar>\n                <UpdateManifestError\n                    postErr={postErr}\n                    setPostErr={setPostErr}\n                />\n                {manifest.isDefault ? (\n                    <VolumeSearch\n                        isFetching={isFetching}\n                        fetchErr={fetchErr}\n                        {...(manifest && manifest['imggroup']\n                            ? { forVolume: manifest['imggroup'] }\n                            : {})}\n                    />\n                ) : (\n                    <div className=\"App\" style={{ paddingTop: 125 }}>\n                        <div>\n                            <Dialog\n                                appData={manifest.appData}\n                                sectionInUseCount={sectionInUseCount}\n                                open={settingsDialogOpen}\n                                handleClose={() => setSettingsDialog(false)}\n                                manifest={manifest}\n                                handleSettingsUpdate={handleSettingsUpdate}\n                            />\n                            <div className=\"container mx-auto flex flex-row py-6\">\n                                <div className=\"w-1/2 flex flex-col\">\n                                    <span className=\"text-gray-600 text-sm\">\n                                        {t('Volume')}\n                                    </span>\n                                    <span className=\"text-sm font-bold text-xl mb-3\">\n                                        {manifest['imggroup']}\n                                        <span\n                                            onClick={() =>\n                                                setSettingsDialog(true)\n                                            }\n                                            className=\"underline text-md font-medium cursor-pointer\"\n                                        >\n                                            <SettingsIcon />\n                                        </span>\n                                    </span>\n                                    {/*<span className=\"underline text-blue-600 cursor-pointer\">*/}\n                                    {/*    {t('Preview')}*/}\n                                    {/*</span>*/}\n                                </div>\n                                <div className=\"w-1/2 flex flex-col\">\n                                    <div className=\"self-end\">\n                                        {auth.isAuthenticated && (\n                                            <span\n                                                className=\"underline text-md font-medium cursor-pointer mr-5\"\n                                                onClick={() =>\n                                                    saveUpdatesToManifest(auth)\n                                                }\n                                            >\n                                                {t('SAVE')}\n                                            </span>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                            <div className=\"container mx-auto\">\n                                <InfiniteScroll\n                                    pageStart={0}\n                                    key={0}\n                                    loadMore={handleLoadMore}\n                                    hasMore={\n                                        imageList.length > renderToIdx &&\n                                        !isLoadingMore\n                                    }\n                                    loader={\n                                        <div\n                                            key=\"circular\"\n                                            className=\"container mx-auto flex items-center justify-center\"\n                                        >\n                                            <CircularProgress />\n                                        </div>\n                                    }\n                                    useWindow={true}\n                                >\n                                    {mapIndex(\n                                        (item: Buda.Image, i: number) => (\n                                            <React.Fragment key={i}>\n                                                {i === 0 && (\n                                                    <CardDropZone\n                                                        i={-1}\n                                                        handleDrop={\n                                                            rearrangeImage\n                                                        }\n                                                    />\n                                                )}\n                                                <Card\n                                                    imageListLength={\n                                                        imageListLength\n                                                    }\n                                                    data={item}\n                                                    key={item.id}\n                                                    i={i}\n                                                />\n                                                <CardDropZone\n                                                    i={i}\n                                                    handleDrop={rearrangeImage}\n                                                />\n                                            </React.Fragment>\n                                        ),\n                                        imageList.slice(0, renderToIdx)\n                                    )}\n                                </InfiniteScroll>\n                            </div>\n                        </div>\n                    </div>\n                )}\n            </DndProvider>\n        </ThemeProvider>\n    )\n}\n\nconst mapStateToProps = function(state: any) {\n    return {\n        manifest: state.manifest,\n    }\n}\n\nexport default connect(mapStateToProps)(App)\n"]},"metadata":{},"sourceType":"module"}